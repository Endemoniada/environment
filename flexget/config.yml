#====================
#= Secrets
#====================
variables: secrets.yml

#====================
#= Web UI
#====================
web_server:
  #run_v2: true
  port: 9092

#====================
#= Templates
#====================
templates:

  global:
    verify_ssl_certificates: no

  #====================
  #= Template: Transmission connection settings
  #====================
  transmission:
    transmission:
      host: localhost
      port: 9091
      #username: {? transmission.username ?}
      #password: {? transmission.password ?}
    pathscrub: windows

  #====================
  #= Template: TV-Shows
  #====================
  tvshows:
    quality: 1080p+ webrip+ h264+
    # For 2.18.0
    sort_by:
      field: quality
      reverse: yes
    #trakt_lookup: yes
    thetvdb_lookup: yes
    set:
      path: '/Alexandria/TV-Series/{{series_name}}/Season {{series_season}}'
      propers: yes
    series:
      #- Archer:
      #    quality: webdl|webrip
      - Atlanta:
          quality: webdl|webrip
      - Barry:
          quality: webdl|webrip
      - Brooklyn Nine-Nine:
          quality: webdl|webrip
      - Counterpart:
          quality: webdl|webrip
      - Divorce (2016):
          quality: webdl|webrip
#      - Fargo:
#          quality: webdl|webrip
      - "Happy!":
          quality: webdl|webrip
          exact: yes
      - Homeland:
          quality: webdl|webrip
      - "Its Always Sunny in Philadelphia":
          alternate_name: "It's Always Sunny in Philadelphia"
          quality: webdl|webrip
      - Kidding:
          quality: webdl|webrip
      - Last Week Tonight with John Oliver:
          identified_by: ep
      #- The Late Show with Stephen Colbert
      - Legion:
          quality: webdl|webrip
      - "Marvel's Agents of S.H.I.E.L.D.":
          quality: webdl|webrip
      - Modern Family:
          quality: webdl|webrip
      - "Mr. Robot":
          quality: webdl|webrip
      - My Little Pony:
          quality: webdl|webrip
      - Once Upon A Time (2011):
          quality: webdl|webrip
      - Rick and Morty:
          quality: webdl|webrip
      - Saturday Night Live:
          quality: 720p+ webdl|webrip
      - Silicon Valley:
          quality: webdl|webrip
      - Suits:
          quality: webdl|webrip
      - Swamp Thing:
          quality: webdl|webrip
      #- The Daily Show (with Trevor Noah)
      - The Deuce:
          quality: webdl|webrip
      #- The Expanse:
      #    quality: webdl|webrip
      - The Good Place:
          quality: webdl|webrip
          season_packs: only
          begin: s03e01
      - The Handmaid's Tale:
          quality: webdl|webrip
      - The Mandalorian:
          quality: 2160p webdl|webrip
      - The Last Ship:
          quality: webdl|webrip
      - The Outsider:
          quality: webdl|webrip
      - The Terror:
          quality: webdl|webrip
      - True Detective:
          quality: webdl|webrip
      - Watchmen:
          quality: webdl|webrip
      - Westworld:
          quality: webdl|webrip
      - "Who Is America?":
          quality: webdl|webrip

  #====================
  #= Template: Movies
  #====================
  movies:
    quality: 1080p+ bluray h264+
    upgrade:
      timeframe: 4 weeks
    proper_movies: no
    imdb_lookup: yes
    tmdb_lookup: yes
    thetvdb_lookup: yes
    set:
      path: '/Alexandria/Movies'
    regexp:
      reject:
        - \b3-?D\b: {from: title}                             # Reject 3D versions

  #====================
  #= Template: Sports
  #====================
  sports:
    quality: 720p+ hdtv+ h264
    set:
      path: '/Users/martin/Movies/Sports'
    regexp:
      accept:
        - NFL.*(2014|2015).*(Giants|Jets)
      from: title

  #============================
  #= Template: Telegram Message
  #============================
  telegram_msg:
    notify:
      entries:
        template: telegram_msg
        via:
          - telegram:
              bot_token: '{? telegram.bot_token ?}'
              parse_mode: markdown
              disable_previews: yes
              recipients:
                - username: '{? telegram.username ?}'


#====================
#= Tasks
#====================
tasks:

  telegram-test:

    disable: seen

    mock:
      - { title: 'Skyscraper.1080p.bluray.x264.dd5.1-group' }
      - { title: 'Mandy.720p.bluray.x264.dd5.1-group' }
      - { title: 'Mandy.1080p.dvd.x264.dd5.1-group' }

    quality: 1080p bluray

    accept_all: yes

    imdb_lookup: yes
    tmdb_lookup: yes

    notify:
      entries:
        template: telegram_msg
        via:
          - telegram:
              bot_token: '{? telegram.bot_token ?}'
              parse_mode: markdown
              disable_previews: yes
              recipients:
                - username: '{? telegram.username ?}'

  #====================
  #= Task: TV-Shows from HDBits.org
  #====================
  tvshows-hdbits:
    priority: 10
    #rss: 'https://hdbits.org/rss/feed?passkey={? hdbits.passkey ?}&feed=dl&cats[]=3c1c3&cats[]=3c1c6&cats[]=1c1c3&cats[]=2c1c3&cats[]=2c1c6'
    rss: 'https://hdbits.org/rss/feed?passkey={? hdbits.passkey ?}&feed=dl&cats[]=2c1c3&cats[]=2c1c6&cats[]=2c5c3&cats[]=2c5c6'

    exec:
      on_start:
        phase: echo "$(date +'%d/%m %T') - executing task - TV-Shows" >> ~/runlog
      on_output:
        for_accepted: echo "+ Accepted '{{title}}'" >> ~/runlog
#        for_rejected: echo "- Rejected '{{title}}' Reason={{reason}}" >> ~/runlog
#        for_failed: echo "? Failed '{{title}}' Reason={{reason}}" >> ~/runlog

    template:
      - tvshows
      - transmission
      - telegram_msg

  #====================
  #= Task: Movies from HDBits.org
  #====================
  movies-hdbits:
    priority: 30

    #rss: 'https://hdbits.org/rss/feed?passkey={? hdbits.passkey ?}&feed=dl&cats[]=3c1c3&cats[]=1c1c3&type_origin=1'
    rss: 'https://hdbits.org/rss/feed?passkey={? hdbits.passkey ?}&feed=dl&cats[]=1c1c3&cats[]=1c1c6&cats[]=1c5c3&cats[]=1c5c6&type_origin=1'

    exec:
      on_start:
        phase: echo "$(date +'%d/%m %T') - executing task - Movies" >> ~/runlog
      on_output:
        for_accepted: echo "+ Accepted '{{title}}'" >> ~/runlog

    imdb_lookup: yes

    #list_queue:
    list_match:
      from:
        - movie_list: movies
    list_add:
      - movie_list: 4k-upgrade

    template:
      - movies
      - transmission
      - telegram_msg

  #====================
  #= Task: Movies from HDBits.org
  #====================
  movies-hdbits-4k-upgrade:
    priority: 32

    rss: 'https://hdbits.org/rss/feed?passkey={? hdbits.passkey ?}&feed=dl&cats[]=1c5c3&cats[]=1c5c5&type_origin=1'

    exec:
      on_start:
        phase: echo "$(date +'%d/%m %T') - executing task - Movies (4K upgrade)" >> ~/runlog
      on_output:
        for_accepted: echo "+ Notified '{{title}}'" >> ~/runlog

    regexp:
      reject:
        - \b3-?D\b: {from: title}                             # Reject 3D versions
    imdb_lookup: yes
    tmdb_lookup: yes
    thetvdb_lookup: yes

    #list_queue:
    list_match:
      from:
        - movie_list: 4k-upgrade

    quality: 2160p+ remux+ h265+

    template:
      - telegram_msg

  #====================
  #= Task: Movies from HDBits wishlist
  #====================
  movies-hdbits-wishlist:
    priority: 31

#    rss: https://hdbits.org/rss/wishlist?passkey={{ s{ecrets.hdbits.passkey }}
    rss: 'https://hdbits.org/rss/my?passkey={? hdbits.passkey ?}'

    exec:
      on_start:
        phase: echo "$(date +'%d/%m %T') - executing task - Movies Wishlist" >> ~/runlog
      on_output:
        for_accepted: echo "+ Accepted '{{title}}'" >> ~/runlog

    proper_movies: no
    imdb_lookup: yes
    tmdb_lookup: yes
    set:
      path: '/Alexandria/Movies'

    template:
      - transmission
      - telegram_msg
    disable:
      - seen
      - seen_info_hash
      - rejected
      - remember_rejected
    accept_all: yes
    no_entries_ok: yes


  #====================
  #= Task: Queue movies from IMDB watchlist
  #====================
  queue-imdb:
    priority: 20

    exec:
      on_start:
        phase: echo "$(date +'%d/%m %T') - executing task - Queue IMDB Watchlist" >> ~/runlog
      on_output:
        for_accepted: echo "+ Added '{{title}}' to queue" >> ~/runlog

#    imdb_list:
#      user_id: ur5604227
#      list: watchlist
#      login: '{? imdb.username ?}'
#      password: '{? imdb.password ?}'
#      list: watchlist

    imdb_watchlist:
      user_id: ur5604227
      list: watchlist

    tmdb_lookup: yes
    imdb_lookup: yes

    template:
      - telegram_msg

    accept_all: yes
    list_add:
      - movie_list: movies


#====================
#= Schedules
#====================
schedules:
  - tasks: 'tvshows-hdbits*'
    interval:
      hours: 1
  - tasks: 'movies-hdbits*'
    interval:
      hours: 1
  - tasks: 'movies-hdbits-wishlist'
    interval:
      hours: 1
  - tasks: 'queue-imdb'
#    interval:
#      hours: 24
    schedule:
      hour: 18
      minute: 30
